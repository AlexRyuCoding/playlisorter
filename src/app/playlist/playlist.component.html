<td-chart [style.height.px]="500"
          [config]="config">
</td-chart>
<mat-toolbar color="primary" class="mat-elevation-z2">
    <button mat-icon-button [routerLink]="['/home']">
      <mat-icon>arrow_back</mat-icon>
    </button>
  <span>Smart Playlist</span>
</mat-toolbar>

<mat-progress-spinner *ngIf="loading" color="primary" mode="indeterminate"></mat-progress-spinner>
<div [style.display]="loading ? 'none' : 'block'">
  <button mat-raised-button color="primary" (click)="sortSmartly()">Sort Intelligently</button>

  <mat-form-field>
    <mat-label>Sort by</mat-label>
    <mat-select [formControl]="sortBy" multiple (selectionChange)="changeFilter($event)">
      <mat-option *ngFor="let filter of sortableColumns" [value]="filter">{{ filter }}</mat-option>
    </mat-select>
  </mat-form-field>

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
    <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let track; let i = index">{{ i }}</td>
    </ng-container>

    <ng-container matColumnDef="preview_url">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let track">
        <button
          mat-icon-button
          [matTooltip]="isPlaying(track.preview_url) ? 'Stop' : 'Play'"
          (click)="play(track.preview_url)"
          [disabled]="!track.preview_url"
        >
          <mat-icon *ngIf="!isPlaying(track.preview_url)">play_arrow</mat-icon>
          <mat-icon *ngIf="isPlaying(track.preview_url)">stop</mat-icon>
        </button>
        <mat-progress-bar *ngIf="isPlaying(track.preview_url)" mode="determinate" [value]="playTime" color="accent"></mat-progress-bar>
      </td>
    </ng-container>

    <ng-container matColumnDef="image_url">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let track">
        <mat-list>
          <mat-list-item>
            <img matListAvatar src="{{ track.image_url }}" />
          </mat-list-item>
        </mat-list>
      </td>
    </ng-container>

    <ng-container matColumnDef="web_url">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let track">
        <a mat-icon-button matTooltip="Open on Spotify" href="{{ track.web_url }}" target="_blank">
          <mat-icon>open_in_new</mat-icon>
        </a>
      </td>
    </ng-container>

    <ng-container matColumnDef="name" sticky>
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let track">{{ track.name }}</td>
    </ng-container>

    <ng-container matColumnDef="artists">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Artists</th>
      <td mat-cell *matCellDef="let track" [matTooltip]="allArtists(track.artists)">{{ track.artists[0] }}</td>
    </ng-container>

    <ng-container matColumnDef="album_name">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Album</th>
      <td mat-cell *matCellDef="let track">{{ track.album_name }}</td>
    </ng-container>

    <ng-container matColumnDef="release_date">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Release Date</th>
      <td mat-cell *matCellDef="let track">{{ track.release_date | date: 'shortDate' }}</td>
    </ng-container>

    <ng-container matColumnDef="added_at">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>added_at</th>
      <td mat-cell *matCellDef="let track">{{ track.added_at | date: 'short' }}</td>
    </ng-container>

    <ng-container matColumnDef="duration_ms">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Duration</th>
      <td mat-cell *matCellDef="let track">{{ createDate(track.duration_ms) | date: 'mm:ss' }}</td>
    </ng-container>

    <ng-container matColumnDef="acousticness">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Acousticness</th>
      <td mat-cell *matCellDef="let track">{{ track.acousticness }}</td>
    </ng-container>

    <ng-container matColumnDef="danceability">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>Danceability</th>
      <td mat-cell *matCellDef="let track">{{ track.danceability }}</td>
    </ng-container>

    <ng-container matColumnDef="energy">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>energy</th>
      <td mat-cell *matCellDef="let track">{{ track.energy }}</td>
    </ng-container>

    <ng-container matColumnDef="instrumentalness">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>instrumentalness</th>
      <td mat-cell *matCellDef="let track">{{ track.instrumentalness }}</td>
    </ng-container>

    <ng-container matColumnDef="key">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>key</th>
      <td mat-cell *matCellDef="let track">{{ track.key }}</td>
    </ng-container>

    <ng-container matColumnDef="liveness">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>liveness</th>
      <td mat-cell *matCellDef="let track">{{ track.liveness }}</td>
    </ng-container>

    <ng-container matColumnDef="loudness">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>loudness</th>
      <td mat-cell *matCellDef="let track">{{ track.loudness }}</td>
    </ng-container>

    <ng-container matColumnDef="mode">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>mode</th>
      <td mat-cell *matCellDef="let track">{{ track.mode }}</td>
    </ng-container>

    <ng-container matColumnDef="speechiness">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>speechiness</th>
      <td mat-cell *matCellDef="let track">{{ track.speechiness }}</td>
    </ng-container>

    <ng-container matColumnDef="tempo">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>tempo</th>
      <td mat-cell *matCellDef="let track">{{ track.tempo }}</td>
    </ng-container>

    <ng-container matColumnDef="time_signature">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>time_signature</th>
      <td mat-cell *matCellDef="let track">{{ track.time_signature }}</td>
    </ng-container>

    <ng-container matColumnDef="valence">
      <th mat-sort-header mat-header-cell *matHeaderCellDef>valence</th>
      <td mat-cell *matCellDef="let track">{{ track.valence }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</div>
